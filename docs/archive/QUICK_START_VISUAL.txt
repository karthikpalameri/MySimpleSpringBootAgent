================================================================================
                   QUICK START - VISUAL REFERENCE CARD
================================================================================

YOUR QUESTION:
How does analyzeLocator work when we're not sending complete HTML content?

ANSWER IN ONE DIAGRAM:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     You Send This to API                    â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚ â€¢ locator: "//*[@id='x']"                 â”‚
         â”‚ â€¢ htmlContent: "<html>...</html>"         â”‚
         â”‚ â€¢ elementDescription: "Search"            â”‚
         â”‚ â€¢ pageUrl: "https://..."                  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     API Server Preprocesses                â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚ â€¢ Store HTML in ThreadLocal (server)      â”‚
         â”‚ â€¢ Clean/optimize HTML                     â”‚
         â”‚ â€¢ 90% size reduction                      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     AI Receives ONLY                       â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚ â€¢ locator: "//*[@id='x']"                 â”‚
         â”‚ â€¢ elementDescription: "Search"            â”‚
         â”‚ â€¢ pageUrl: "https://..."                  â”‚
         â”‚                                            â”‚
         â”‚ âŒ NO HTML SENT! (stays on server)        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     AI Uses Tools to Query HTML            â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚ â€¢ findByXPath("//*[@id='x']")             â”‚
         â”‚   Tool queries ThreadLocal (server)      â”‚
         â”‚   Returns: "No matches"                   â”‚
         â”‚                                            â”‚
         â”‚ â€¢ getAllInteractiveElements()            â”‚
         â”‚   Tool queries ThreadLocal (server)      â”‚
         â”‚   Returns: 50+ elements                   â”‚
         â”‚                                            â”‚
         â”‚ â€¢ findByText("Search")                    â”‚
         â”‚   Tool queries ThreadLocal (server)      â”‚
         â”‚   Returns: Found it!                      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     AI Returns Result                      â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚ {                                          â”‚
         â”‚   recommendedLocator: "search-id",        â”‚
         â”‚   recommendedLocatorType: "ID",           â”‚
         â”‚   alternatives: {...},                     â”‚
         â”‚   confidence: 0.95                        â”‚
         â”‚ }                                          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     You Get Response                       â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚ Best locator + alternatives               â”‚
         â”‚ Ready to use in your tests!               â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
                              KEY INSIGHT
================================================================================

HTML is NOT sent to AI!
    â†“
HTML is stored on server in ThreadLocal
    â†“
AI gets 3 small parameters only
    â†“
AI calls tools to query stored HTML
    â†“
Tools return only what's needed
    â†“
RESULT: Fast âœ“ Cheap âœ“ Secure âœ“

================================================================================
                         THE 3 PARAMETERS AI GETS
================================================================================

1. failedLocator
   â””â”€ The locator that didn't work
   â””â”€ Example: "//*[@id='search']"
   â””â”€ Size: Small string

2. elementDescription
   â””â”€ What you're looking for
   â””â”€ Example: "Search button"
   â””â”€ Size: Small string

3. pageUrl
   â””â”€ Page context (optional)
   â””â”€ Example: "https://example.com"
   â””â”€ Size: Small string

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
TOTAL: 3 small params (not the 50KB HTML!)

================================================================================
                         THE 6 TOOLS AI CAN USE
================================================================================

Tool                    | Purpose                  | Example
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
findByXPath()           | Test XPath expressions   | //*[@id='x']
findByCss()             | Test CSS selectors       | button.search
findById()              | Find by ID               | search-input
findByAttribute()       | Find by HTML attribute   | data-testid='btn'
findByText()            | Find by visible text     | "Click here"
getAllInteractive()     | List all buttons/inputs  | Returns array

All tools query the stored HTML on server (no network!)

================================================================================
                           WHAT AI DOES
================================================================================

Step 1: Test the failed locator
        â””â”€ Understand WHY it failed

Step 2: See all available elements
        â””â”€ List interactive buttons, inputs, links

Step 3: Find the target element
        â””â”€ Use element description to locate it

Step 4: Test alternative locators
        â””â”€ Try By.id, By.css, By.xpath

Step 5: Rank by reliability
        â””â”€ By.id is best (most stable)

Step 6: Return recommendations
        â””â”€ Send back best + alternatives

================================================================================
                         REQUEST & RESPONSE
================================================================================

REQUEST (You send):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

POST /api/locators/analyze

{
  "locator": "//*[@id='old']",         â† REQUIRED
  "htmlContent": "<html>...</html>",   â† REQUIRED (stays on server!)
  "elementDescription": "Search",      â† optional
  "pageUrl": "https://..."             â† optional
}


RESPONSE (You get):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

200 OK

{
  "elementFound": true,
  "recommendedLocator": "new-id",
  "recommendedLocatorType": "ID",
  "alternatives": {
    "CSS_SELECTOR": "input.search",
    "XPATH": "//*[@id='new-id']"
  },
  "confidence": 0.95,
  "explanation": "Found input with stable ID..."
}

================================================================================
                       WHY THIS DESIGN IS SMART
================================================================================

Traditional Way (âŒ Wasteful)
  Request â†’ {locator + 50KB HTML} â†’ AI processes
  Cost: $$$$$ (50KB sent to AI)
  Speed: Slow
  Tokens: Many

Our Way (âœ… Efficient)
  Request â†’ {locator + 50KB HTML}
                    â†“ (stay on server)
              {3 params} â†’ AI uses tools
  Cost: $ (only 3 params to AI)
  Speed: Fast
  Tokens: Few

================================================================================
                         COMPONENTS AT A GLANCE
================================================================================

LocatorController
  â†“ (validates)
LocatorRequestValidator

LocatorController
  â†“ (preprocesses)
HtmlPreprocessor
  â†“
HtmlMinificationService & HtmlUtilityService

LocatorController
  â†“ (stores)
DomQueryTools (ThreadLocal storage)

LocatorController
  â†“ (calls)
LocatorAnalyzerAI (Claude with tools)
  â†“ (queries)
DomQueryTools (fetches what's needed)

LocatorController
  â†“ (formats)
LocatorResponseMapper

================================================================================
                        ERROR RESPONSES
================================================================================

400 Bad Request
  â”œâ”€ Missing or empty locator
  â”œâ”€ Missing or empty htmlContent
  â”œâ”€ Invalid HTML
  â””â”€ Return: {"statusCode": 400, "error": "..."}

500 Internal Error
  â”œâ”€ AI processing failed
  â”œâ”€ Unexpected error
  â””â”€ Return: {"statusCode": 500, "error": "..."}

200 OK (Success)
  â”œâ”€ Element found
  â”œâ”€ Alternatives provided
  â””â”€ Return: {"elementFound": true, "recommendations": {...}}

================================================================================
                       LOCATOR PREFERENCE ORDER
================================================================================

ğŸ¥‡ By.ID (Best)
   â””â”€ Most stable and fast
   â””â”€ Recommended when available

ğŸ¥ˆ By.NAME
   â””â”€ Good for form elements
   â””â”€ Usually stable

ğŸ¥‰ By.LINK_TEXT
   â””â”€ For hyperlinks only

4ï¸âƒ£ By.CSS_SELECTOR
   â””â”€ Flexible and performant

5ï¸âƒ£ By.CLASS_NAME
   â””â”€ When classes are unique (risky)

6ï¸âƒ£ By.XPATH (Worst)
   â””â”€ Powerful but brittle
   â””â”€ Last resort

================================================================================
                         QUICK CHECKLIST
================================================================================

Before you send a request:
â˜ Do you have the failed locator?
â˜ Do you have the page HTML?
â˜ Optional: Element description?
â˜ Optional: Page URL?

The system will:
â˜ Validate your input
â˜ Preprocess & store HTML locally
â˜ Tell AI about the problem (3 params only!)
â˜ AI uses tools to analyze
â˜ Return best alternative

You'll receive:
â˜ Best locator strategy
â˜ The actual locator string
â˜ Alternative locators
â˜ Confidence score (0-1)
â˜ Explanation

================================================================================
                         WHERE TO LEARN MORE
================================================================================

Start here:
  â†’ SIMPLE_FLOW_GUIDE.md (ASCII diagrams, no plugins needed)

Then read:
  â†’ FLOW_DIAGRAMS.md (beautiful Mermaid diagrams)
  â†’ DOCUMENTATION.md (complete reference)
  â†’ README.md (quick start)

View diagrams:
  â†’ In GitHub (automatic rendering)
  â†’ In mermaid.live (copy & paste)
  â†’ In VSCode (built-in support)
  â†’ In IntelliJ (install Mermaid plugin)

================================================================================
                           THE BIG PICTURE
================================================================================

You send broken locator + HTML
         â†“
System stores HTML locally
         â†“
AI gets only 3 small parameters
         â†“
AI calls tools to query HTML
         â†“
AI finds best alternative
         â†“
You get recommendations
         â†“
Use them in your tests!

Fast âœ“ Cheap âœ“ Secure âœ“

================================================================================
